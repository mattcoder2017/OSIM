@model IEnumerable<Wrox.BooksRead.Web.Models.Product>

@{
    ViewBag.Title = "View";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>All Products</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
@*<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Name)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.CreateDate)
        </th>
        <th>
           @Html.DisplayNameFor(model => model.Category1.Name) 
        </th>
        <th></th>
    </tr>*@

@foreach (var item in Model) {
    <ul>
        <li>
            @Html.DisplayFor(modelItem => item.Name)
            @Html.DisplayFor(modelItem => item.CreateDate)
            @Html.DisplayFor(modelItem => item.Category1.Name) 
            @Html.ActionLink("Edit", "Edit", new { id=item.Id }) |
            @Html.ActionLink("Details", "Details", new { id=item.Id }) |
            @*@Html.ActionLink("Delete", "Delete", new { id=item.Id })*@
            <a href="#" class="asyncClass" data-value="@item.Id">Delete</a>


        </li>
    </ul>
}

@*</table>*@

@section scripts
{   <script>
       $(document).ready(
           $(".asyncClass").click(
                 function (e)
                 {
                     var link = $(e.target);
                     var id = link.attr("data-value");
                     bootbox.dialog(
                         {
                             message: "Do you really want to remove this product??",
                             title: "Confirmation",
                             buttons:
                                 {
                                     no: {
                                         label: "No",
                                         className: "btn-default",
                                         callback: function() {bootbox.hideAll();}
                                     },
                                     yes: {
                                         label: "Yes",
                                         className: "btn-danger",
                                         callback: function() {
                                                 $.ajax(
                                                {
                                                    url : "/api/Product/"+ id,
                                                    method: "DELETE"
                                                })
                                                     .done(function() {
                                                        alert("delete succesful!");
                                                        link.parents("ul").fadeOut(function()
                                                        { $(this).remove(); })
                                                     })
                                                     .fail(function (a)
                                                       {
                                                           alert(a);
                                                       })
                                            }}}}
                  )}))
       </script>       
}